SELECT IF(from_users_id=11, to_users_id, from_users_id) AS friend_id, ((SELECT COUNT(*) FROM vk.messages WHERE from_users_id = friend_id AND to_users_id = 11) + (SELECT COUNT(*) FROM vk.messages WHERE to_users_id = friend_id AND from_users_id = 11)) AS messages_count FROM vk.friend_requests WHERE (from_users_id = 11 OR to_users_id = 11) AND `status` = 1 ORDER BY messages_count DESC;